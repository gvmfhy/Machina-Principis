<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Machina Principis - Machiavellian AI Civilization</title>
  
  <!-- Google Fonts - Roboto -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  
  <!-- Main CSS -->
  <style>
    /* Base styles */
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f0f0f0;
      color: #333;
      transition: background-color 0.3s ease;
      overflow: hidden;
    }
    
    body.dark-mode {
      background-color: #121212;
      color: #f5f5f5;
    }
    
    /* Configuration container */
    .config-container {
      max-width: 800px;
      width: 90%;
      margin: 0 auto;
      padding: 20px;
      overflow-y: auto;
      max-height: 90vh;
    }
    
    .config-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .config-header h1 {
      color: #3f51b5;
      margin-bottom: 10px;
    }
    
    .config-header p {
      color: #666;
      max-width: 600px;
      margin: 0 auto;
    }
    
    .config-form {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    
    .config-section {
      margin-bottom: 25px;
      border-bottom: 1px solid #eee;
      padding-bottom: 20px;
    }
    
    .config-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .config-section-title {
      font-size: 1.2rem;
      font-weight: 500;
      margin-bottom: 15px;
      color: #3f51b5;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .form-field {
      flex: 1;
      min-width: 180px;
    }
    
    /* More responsive adjustments */
    @media (max-width: 600px) {
      .form-field {
        min-width: 100%;
      }
      
      .form-row {
        flex-direction: column;
        gap: 10px;
      }
      
      .config-actions {
        flex-direction: column;
      }
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      font-size: 0.9rem;
    }
    
    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: inherit;
      font-size: 1rem;
    }
    
    .checkbox-field {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .checkbox-field label {
      margin-bottom: 0;
    }
    
    .config-actions {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      gap: 20px;
    }
    
    .config-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: background-color 0.3s;
    }
    
    .primary-btn {
      background-color: #3f51b5;
      color: white;
    }
    
    .primary-btn:hover {
      background-color: #303f9f;
    }
    
    .secondary-btn {
      background-color: #f5f5f5;
      color: #333;
    }
    
    .secondary-btn:hover {
      background-color: #e0e0e0;
    }
    
    .form-hint {
      font-size: 0.8rem;
      color: #666;
      margin-top: 4px;
    }
    
    .dark-mode .config-header h1 {
      color: #757de8;
    }
    
    .dark-mode .config-header p {
      color: #bbb;
    }
    
    .dark-mode .config-form {
      background-color: #1e1e1e;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }
    
    .dark-mode .config-section {
      border-bottom-color: #333;
    }
    
    .dark-mode .config-section-title {
      color: #757de8;
    }
    
    .dark-mode input[type="text"],
    .dark-mode input[type="number"],
    .dark-mode select {
      background-color: #2a2a2a;
      border-color: #444;
      color: #f5f5f5;
    }
    
    .dark-mode .form-hint {
      color: #aaa;
    }
    
    .dark-mode .secondary-btn {
      background-color: #333;
      color: #f5f5f5;
    }
    
    .dark-mode .secondary-btn:hover {
      background-color: #444;
    }
    
    .api-key-warning {
      color: #f44336;
      font-weight: bold;
      font-size: 0.9rem;
      margin-top: 8px;
    }
    
    .preset-options {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .preset-btn {
      padding: 8px 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: #f5f5f5;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .preset-btn:hover {
      background-color: #e0e0e0;
    }
    
    .preset-btn.active {
      background-color: #3f51b5;
      color: white;
      border-color: #3f51b5;
    }
    
    .dark-mode .preset-btn {
      background-color: #2a2a2a;
      border-color: #444;
    }
    
    .dark-mode .preset-btn:hover {
      background-color: #333;
    }
    
    .dark-mode .preset-btn.active {
      background-color: #3f51b5;
      color: white;
      border-color: #3f51b5;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      color: white;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Simulation container specific styles */
    #simulation-container {
      display: grid;
      grid-template-columns: 1fr 300px;
      grid-template-rows: 1fr 100px;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
    }
    
    /* Responsive layout for smaller screens */
    @media (max-width: 1000px) {
      #simulation-container {
        grid-template-columns: 1fr 250px;
      }
    }
    
    @media (max-width: 800px) {
      #simulation-container {
        grid-template-columns: 1fr 200px;
      }
    }
    
    /* Map container */
    .map-container {
      grid-column: 1;
      grid-row: 1 / span 2;
      overflow: hidden;
      position: relative;
      background-color: #2c3e50;
    }
    
    /* Info panel */
    .info-panel {
      grid-column: 2;
      grid-row: 1;
      overflow-y: auto;
      padding: 10px;
      background-color: #f5f5f5;
      border-left: 1px solid #ccc;
    }
    
    body.dark-mode .info-panel {
      background-color: #2d2d2d;
      border-left: 1px solid #444;
    }
    
    /* Control panel */
    .control-panel {
      grid-column: 2;
      grid-row: 2;
      padding: 10px;
      background-color: #e0e0e0;
      border-left: 1px solid #ccc;
      border-top: 1px solid #ccc;
      display: flex;
      flex-direction: column;
    }
    
    body.dark-mode .control-panel {
      background-color: #333;
      border-left: 1px solid #444;
      border-top: 1px solid #444;
    }
    
    /* Map styles */
    .map-grid {
      display: grid;
      position: absolute;
    }
    
    .map-tile {
      width: 64px;
      height: 64px;
      position: relative;
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-sizing: border-box;
      transition: transform 0.2s ease;
    }
    
    .map-tile:hover {
      transform: scale(1.05);
      z-index: 10;
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }
    
    .map-tile.selected {
      border: 2px solid yellow;
      z-index: 5;
    }
    
    /* Tile types */
    .tile-plains { background-color: #8bc34a; }
    .tile-hills { background-color: #795548; }
    .tile-mountains { background-color: #607d8b; }
    .tile-water { background-color: #2196f3; }
    .tile-forest { background-color: #33691e; }
    
    /* Resource indicators */
    .resource-indicator {
      position: absolute;
      bottom: 5px;
      right: 5px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background-color: yellow;
      border: 1px solid black;
    }
    
    /* Settlement indicator */
    .settlement-indicator {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: white;
      border: 2px solid black;
      z-index: 5;
    }
    
    /* Unit indicator */
    .unit-indicator {
      position: absolute;
      bottom: 5px;
      left: 5px;
      width: 16px;
      height: 16px;
      background-color: white;
      border: 1px solid black;
      z-index: 4;
    }
    
    /* Buttons */
    button {
      padding: 8px 12px;
      margin: 5px;
      border: none;
      border-radius: 4px;
      background-color: #4caf50;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    
    button:hover {
      background-color: #388e3c;
    }
    
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    
    body.dark-mode button {
      background-color: #388e3c;
    }
    
    body.dark-mode button:hover {
      background-color: #2e7d32;
    }
    
    /* Info panels */
    .panel-section {
      margin-bottom: 15px;
      padding: 10px;
      background-color: rgba(0, 0, 0, 0.05);
      border-radius: 4px;
    }
    
    body.dark-mode .panel-section {
      background-color: rgba(255, 255, 255, 0.05);
    }
    
    .panel-title {
      font-weight: bold;
      margin-bottom: 5px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 3px;
    }
    
    /* FPS counter */
    .fps-counter {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 5px;
      border-radius: 3px;
      font-family: monospace;
    }
    
    /* Tabs */
    .tab-buttons {
      display: flex;
      border-bottom: 1px solid #ccc;
      margin-bottom: 10px;
    }
    
    .tab-button {
      padding: 8px 15px;
      background-color: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: inherit;
      cursor: pointer;
    }
    
    .tab-button.active {
      border-bottom: 2px solid #4caf50;
      font-weight: bold;
    }
    
    body.dark-mode .tab-button.active {
      border-bottom: 2px solid #388e3c;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Observer modes */
    .observer-controls {
      display: flex;
      margin-bottom: 10px;
    }
    
    .observer-mode-button {
      flex: 1;
      padding: 5px;
      text-align: center;
      border: 1px solid #ccc;
      background-color: #f0f0f0;
      cursor: pointer;
    }
    
    body.dark-mode .observer-mode-button {
      background-color: #333;
      border-color: #444;
    }
    
    .observer-mode-button.active {
      background-color: #4caf50;
      color: white;
      font-weight: bold;
    }
    
    body.dark-mode .observer-mode-button.active {
      background-color: #388e3c;
    }
    
    /* Agent visualization */
    .agent-visualization {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 10;
    }
    
    .agent-avatar {
      position: absolute;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-size: cover;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      border: 2px solid white;
      transition: all 0.3s ease;
      z-index: 20;
    }
    
    .agent-thinking {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .thinking-dot {
      width: 8px;
      height: 8px;
      background-color: white;
      border-radius: 50%;
      animation: thinking 1.4s infinite ease-in-out;
    }
    
    .thinking-dot:nth-child(1) { animation-delay: 0s; }
    .thinking-dot:nth-child(2) { animation-delay: 0.2s; }
    .thinking-dot:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes thinking {
      0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }
    
    .speech-bubble {
      position: absolute;
      max-width: 200px;
      background-color: white;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      font-size: 12px;
      z-index: 15;
      transition: opacity 0.3s ease;
    }
    
    .speech-bubble:after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      border-width: 10px 10px 0;
      border-style: solid;
      border-color: white transparent transparent;
    }
    
    .relationship-line {
      position: absolute;
      height: 2px;
      background-color: rgba(255,255,255,0.4);
      transform-origin: 0 0;
      z-index: 5;
      pointer-events: none;
    }
    
    /* Timeline visualization */
    .timeline-container {
      position: absolute;
      bottom: 20px;
      left: 20px;
      right: 20px;
      height: 60px;
      background-color: rgba(0,0,0,0.6);
      border-radius: 5px;
      display: flex;
      align-items: center;
      padding: 0 10px;
      z-index: 50;
      pointer-events: auto;
    }
    
    .timeline {
      position: relative;
      flex: 1;
      height: 4px;
      background-color: rgba(255,255,255,0.3);
    }
    
    .timeline-event {
      position: absolute;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: white;
      transform: translate(-50%, -50%);
      top: 50%;
      cursor: pointer;
    }
    
    .timeline-event.battle { background-color: #f44336; }
    .timeline-event.settlement { background-color: #4caf50; }
    .timeline-event.tech { background-color: #2196f3; }
    .timeline-event.diplomacy { background-color: #ff9800; }
  </style>
</head>
<body>
  <!-- Configuration Form -->
  <div id="config-container" class="config-container">
    <div class="config-header">
      <h1>Machina Principis - Machiavellian AI Civilization</h1>
      <p>Observe and analyze strategic behavior, deception, alliance formation, and betrayal among AI agents in a controlled environment.</p>
    </div>
    
    <div class="preset-options">
      <button class="preset-btn active" data-preset="default">Default</button>
      <button class="preset-btn" data-preset="small">Small World (Quick)</button>
      <button class="preset-btn" data-preset="complex">Complex World</button>
      <button class="preset-btn" data-preset="resource-scarce">Resource Scarcity</button>
    </div>
    
    <form id="config-form" class="config-form">
      <div class="config-section">
        <h3 class="config-section-title">Game Settings</h3>
        
        <div class="form-row">
          <div class="form-field">
            <label for="mapWidth">Map Width</label>
            <input type="number" id="mapWidth" name="mapWidth" min="8" max="32" value="16">
          </div>
          
          <div class="form-field">
            <label for="mapHeight">Map Height</label>
            <input type="number" id="mapHeight" name="mapHeight" min="8" max="32" value="16">
          </div>
          
          <div class="form-field">
            <label for="numCivilizations">Number of Civilizations</label>
            <input type="number" id="numCivilizations" name="numCivilizations" min="2" max="8" value="4">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-field">
            <label for="maxTurns">Maximum Turns</label>
            <input type="number" id="maxTurns" name="maxTurns" min="10" max="500" value="100">
          </div>
          
          <div class="form-field">
            <label for="turnDelay">Turn Delay (ms)</label>
            <input type="number" id="turnDelay" name="turnDelay" min="500" max="10000" step="500" value="2000">
            <div class="form-hint">Delay between turns (lower = faster simulation)</div>
          </div>
          
          <div class="form-field">
            <label for="resourceDistribution">Resource Distribution</label>
            <select id="resourceDistribution" name="resourceDistribution">
              <option value="balanced">Balanced</option>
              <option value="random">Random</option>
              <option value="clustered">Clustered</option>
              <option value="scarce">Scarce</option>
              <option value="abundant">Abundant</option>
            </select>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-field checkbox-field">
            <input type="checkbox" id="autoPlay" name="autoPlay" checked>
            <label for="autoPlay">Auto-play</label>
          </div>
          
          <div class="form-field checkbox-field">
            <input type="checkbox" id="revealMap" name="revealMap">
            <label for="revealMap">Reveal entire map</label>
          </div>
        </div>
      </div>
      
      <div class="config-section">
        <h3 class="config-section-title">AI Settings</h3>
        
        <div class="form-row">
          <div class="form-field">
            <label for="llmProvider">LLM Provider</label>
            <select id="llmProvider" name="llmProvider">
              <option value="local" selected>Local (stub responses)</option>
              <option value="claude">Anthropic (Claude)</option>
              <option value="openai">OpenAI (GPT-4)</option>
            </select>
          </div>
          
          <div class="form-field">
            <label for="llmTemperature">Temperature</label>
            <input type="number" id="llmTemperature" name="llmTemperature" min="0" max="1" step="0.1" value="0.7">
            <div class="form-hint">Higher = more creative/random responses</div>
          </div>
        </div>
        
        <div class="form-field">
          <label for="llmApiKey">API Key</label>
          <input type="text" id="llmApiKey" name="llmApiKey" placeholder="Enter your API key">
          <div class="form-hint">Your API key is never stored or transmitted beyond your local machine</div>
          <div id="api-key-warning" class="api-key-warning" style="display: none;">
            API key is required for selected provider
          </div>
        </div>
        
        <div class="form-field checkbox-field">
          <input type="checkbox" id="useLlmStub" name="useLlmStub" checked>
          <label for="useLlmStub">Use stub responses (no API calls)</label>
          <div class="form-hint">For testing without using API credits</div>
        </div>
      </div>
      
      <div class="config-section">
        <h3 class="config-section-title">Display Settings</h3>
        
        <div class="form-row">
          <div class="form-field">
            <label for="observationMode">Default Observation Mode</label>
            <select id="observationMode" name="observationMode">
              <option value="omniscient">Omniscient (see all private thoughts)</option>
              <option value="diplomat">Diplomat (see only public actions)</option>
              <option value="historian">Historian (see analytical overview)</option>
            </select>
          </div>
        </div>
        
        <div class="form-field checkbox-field">
          <input type="checkbox" id="darkMode" name="darkMode">
          <label for="darkMode">Dark Mode</label>
        </div>
        
        <div class="form-field checkbox-field">
          <input type="checkbox" id="debug" name="debug">
          <label for="debug">Debug Mode</label>
          <div class="form-hint">Shows additional information and metrics</div>
        </div>
        
        <div class="form-field checkbox-field">
          <input type="checkbox" id="showAgentAvatars" name="showAgentAvatars" checked>
          <label for="showAgentAvatars">Show Agent Avatars</label>
          <div class="form-hint">Display visual representations of AI agents on the map</div>
        </div>
        
        <div class="form-field checkbox-field">
          <input type="checkbox" id="showTimeline" name="showTimeline" checked>
          <label for="showTimeline">Show Event Timeline</label>
          <div class="form-hint">Display timeline of key events during simulation</div>
        </div>
      </div>
      
      <div class="config-actions">
        <button type="button" id="reset-btn" class="config-btn secondary-btn">Reset</button>
        <button type="submit" id="start-btn" class="config-btn primary-btn">Start Simulation</button>
      </div>
    </form>
  </div>
  
  <!-- Simulation Container (initially hidden) -->
  <div id="simulation-container" style="display: none;"></div>
  
  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner"></div>
    <div id="loading-message">Initializing simulation...</div>
  </div>
  
  <!-- Electron Renderer Script -->
  <script src="electron-renderer.js"></script>
</body>
</html>